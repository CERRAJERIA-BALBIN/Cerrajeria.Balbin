<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>C&B Cerrajer√≠a Balb√≠n - Socio</title>
<style>
    body {
        background: radial-gradient(circle at top, #1a1a1a, #000);
        color: #f4c542;
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
    }
    h1 {
        color: #f4c542;
        margin-bottom: 5px;
    }
    h2 {
        color: #e0e0e0;
        margin-top: 0;
        font-size: 18px;
    }
    .card {
        border: 2px solid #f4c542;
        border-radius: 12px;
        padding: 15px;
        margin: 20px auto;
        width: 320px;
        background: rgba(255,255,255,0.05);
        box-shadow: 0 0 10px rgba(244,197,66,0.2);
    }
    .footer {
        margin-top: 30px;
        color: #ccc;
        font-size: 14px;
    }
</style>
</head>
<body>

<h1>C&B Cerrajer√≠a Balb√≠n</h1>
<h2>Membres√≠a Digital</h2>

<div class="card">
    <h3>Datos del Socio</h3>
    <p><b>Nombre:</b> <span id="nombre">...</span></p>
    <p><b>N¬∞ Socio:</b> <span id="nsocio">...</span></p>
    <p><b>Plan:</b> <span id="plan">...</span></p>
    <p><b>Estado de Pago:</b> <span id="estado">...</span></p>
</div>

<div class="card">
    <h3>√öltimos 3 Servicios</h3>
    <div id="servicios">Cargando...</div>
</div>

<div class="footer">
    Av. Balb√≠n 1377 - Tandil<br>
    Tel: 2494240906
</div>

<script>
const SOCIOS_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRQqKxPsd9noQiLmoq4qG6YUvxP-bamjSYCc54KcR67aJilqTSVJmYWRH844FS3jZRrN-jN3Kc3R40k/pub?gid=0&single=true&output=csv";
const SERVICIOS_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRQqKxPsd9noQiLmoq4qG6YUvxP-bamjSYCc54KcR67aJilqTSVJmYWRH844FS3jZRrN-jN3Kc3R40k/pub?gid=1745929313&single=true&output=csv";

async function fetchCSV(url) {
    const res = await fetch(url);
    const text = await res.text();

    // Si el CSV devuelve HTML, mostrar error
    if (text.startsWith("<")) {
        throw new Error("El enlace no devuelve CSV. Revis√° que est√© publicado correctamente como CSV p√∫blico.");
    }

    const rows = text.trim().split("\n").map(r => r.split(","));
    const headers = rows.shift().map(h => h.trim());
    return rows.map(r => {
        let obj = {};
        headers.forEach((h, i) => obj[h] = (r[i] || "").trim());
        return obj;
    });
}

async function main() {
    const params = new URLSearchParams(window.location.search);
    const socioId = params.get("id");

    if (!socioId) {
        document.getElementById("servicios").textContent = "Falta el ID del socio en la URL (?id=1)";
        return;
    }

    try {
        // --- Cargar socios ---
        const socios = await fetchCSV(SOCIOS_URL);
        const socio = socios.find(s => s["N¬∞ Socio"] === socioId);

        if (socio) {
            document.getElementById("nombre").textContent = socio["Nombre"] || "Sin datos";
            document.getElementById("nsocio").textContent = socio["N¬∞ Socio"] || socioId;
            document.getElementById("plan").textContent = socio["Plan"] || "Sin datos";
            document.getElementById("estado").textContent = socio["Estado de Pago"] || "Sin datos";
        } else {
            document.getElementById("nombre").textContent = "No encontrado";
        }

        // --- Cargar servicios ---
        const servicios = await fetchCSV(SERVICIOS_URL);
        const ultimos = servicios.filter(s => s["N¬∞ Socio"] === socioId).slice(-3);

        if (ultimos.length > 0) {
            document.getElementById("servicios").innerHTML = ultimos.map(s =>
                <p>üõ†Ô∏è ${Object.entries(s).map(([k, v]) => `${k}: ${v}).join(" | ")}</p>`
            ).join("");
        } else {
            document.getElementById("servicios").textContent = "No hay servicios registrados.";
        }

    } catch (error) {
        document.getElementById("servicios").textContent = "Error: " + error.message;
        console.error(error);
    }
}

main();
</script>

</body>
</html>
