<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Carnet Digital - C&B Cerrajer√≠a Balb√≠n</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: radial-gradient(circle, #0c0c0c, #1a1a1a);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 20px;
    }
    .card {
      border: 2px solid #d4af37;
      border-radius: 12px;
      padding: 20px;
      max-width: 420px;
      margin: 0 auto;
      background: rgba(20,20,20,0.9);
      box-shadow: 0 0 15px #d4af37;
    }
    h1 {
      color: #d4af37;
      margin-bottom: 5px;
    }
    h2 {
      color: #d4af37;
      font-size: 1.1em;
      border-bottom: 1px solid #d4af37;
      padding-bottom: 5px;
      margin-bottom: 10px;
    }
    p { margin: 6px 0; }
    #servicios { margin-top: 10px; font-size: 0.95em; }
  </style>
</head>
<body>

  <div class="card">
    <h1>C&B Cerrajer√≠a Balb√≠n</h1>
    <p>Carnet Digital de Socio</p>

    <h2>Datos del Socio</h2>
    <p><strong>Nombre:</strong> <span id="nombre">...</span></p>
    <p><strong>Plan:</strong> <span id="plan">...</span></p>
    <p><strong>Estado:</strong> <span id="estado">...</span></p>

    <h2>√öltimos Servicios Utilizados</h2>
    <div id="servicios">Cargando...</div>

    <p style="margin-top:20px; font-size:0.9em; color:#ccc;">
      C&B Cerrajer√≠a Balb√≠n ¬∑ Av. Balb√≠n 1377 - Tandil<br>
      Contacto: 2494 240906
    </p>
  </div>

  <script>
    async function cargarDatos() {
      const sociosURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRQqKxPsd9noQiLmoq4qG6YUvxP-bamjSYCc54KcR67aJilqTSVJmYWRH844FS3jZRrN-jN3Kc3R40k/pub?gid=0&single=true&output=csv";
      const serviciosURL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRQqKxPsd9noQiLmoq4qG6YUvxP-bamjSYCc54KcR67aJilqTSVJmYWRH844FS3jZRrN-jN3Kc3R40k/pub?gid=1745929313&single=true&output=csv";

      const params = new URLSearchParams(window.location.search);
      const idSocio = params.get("id");
      if (!idSocio) return;

      try {
        const sociosRes = await fetch(sociosURL);
        if (!sociosRes.ok) throw new Error("No se pudo obtener socios");
        const sociosText = await sociosRes.text();

        const serviciosRes = await fetch(serviciosURL);
        if (!serviciosRes.ok) throw new Error("No se pudo obtener servicios");
        const serviciosText = await serviciosRes.text();

        const parseCSV = (text) => {
          const [headerLine, ...lines] = text.trim().split("\n");
          const headers = headerLine.split(",");
          return lines.map(line => {
            const values = line.split(",");
            return Object.fromEntries(headers.map((h, i) => [h.trim(), values[i]?.trim()]));
          });
        };

        const socios = parseCSV(sociosText);
        const socio = socios.find(s => s["N¬∞ Socio"] == idSocio);

        if (socio) {
          document.getElementById("nombre").textContent = socio["Nombre y Apellido"] || "‚Äî";
          document.getElementById("plan").textContent = socio["Plan"] || "‚Äî";
          document.getElementById("estado").textContent = socio["Estado de Pago"] || "‚Äî";
        } else {
          document.getElementById("nombre").textContent = "Socio no encontrado";
        }

        const servicios = parseCSV(serviciosText).filter(s => s["N¬∞ Socio"] == idSocio);
        const contenedor = document.getElementById("servicios");

        if (servicios.length === 0) {
          contenedor.textContent = "Sin servicios registrados";
        } else {
          contenedor.innerHTML = servicios.map(s =>
            <div>üîß ${s["Servicio"] || "Servicio no especificado"} - ${s["Observaciones"] || ""}</div>
          ).join("");
        }

      } catch (err) {
        console.error("Error al cargar datos:", err);
        document.getElementById("servicios").textContent = "Error al cargar datos.";
      }
    }

    cargarDatos();
  </script>
</body>
</html>
